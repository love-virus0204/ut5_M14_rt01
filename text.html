<!doctype html>
<html lang="zh-Hant">
<meta charset="utf-8">
<title>GAS form-urlencode 測試工具（零干擾）</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui,Roboto,Arial,sans-serif;padding:12px}
  .grid{display:grid;grid-template-columns:140px 1fr;gap:8px 10px;align-items:center}
  input,button{font-size:14px;padding:8px}
  pre{white-space:pre-wrap;background:#111;color:#eee;padding:10px;border-radius:8px;margin-top:12px}
  .row{margin:8px 0}
  .btns{display:flex;gap:8px;margin-top:8px}
</style>

<h2>GAS form 測試</h2>

<div class="row">
  <label>GAS /exec URL</label>
  <input id="api" placeholder="https://script.google.com/macros/s/xxx/exec" style="width:100%">
</div>

<form id="F" class="grid">
  <label>action</label><input name="action" value="submit">
  <label>date</label><input name="date" value="2025/09/24">
  <label>shift</label><input name="shift" value="A">
  <label>part_no</label><input name="part_no" value="ABC1234">
  <label>lot</label><input name="lot" value="FA-001">
  <label>qty</label><input name="qty" value="10">
  <label>sample_cnt</label><input name="sample_cnt" value="0">
  <label>z7</label><input name="z7" value="0">
  <label>z8</label><input name="z8" value="0">
  <label>z9</label><input name="z9" value="0">
  <label>z10</label><input name="z10" value="0">
  <label>z11</label><input name="z11" value="0">
  <label>z12</label><input name="z12" value="0">
  <label>z13</label><input name="z13" value="0">
  <label>inspector</label><input name="inspector" value="TEST">
  <label>remark</label><input name="remark" value="">
  <label>key2</label><input name="key2" value="2025/09/24|A|ABC1234|FA-001|TRUE">
  <label>key</label><input name="key"  value="2025/09/24|A|ABC1234|FA-001">
</form>

<div class="btns">
  <button id="btnNative" type="button">A. 原生表單 POST（開新分頁）</button>
  <button id="btnFetch"  type="button">B. fetch 表單 POST（顯示回應）</button>
</div>

<pre id="out">(等待測試)</pre>

<script>
const $ = s => document.querySelector(s);
const out = $('#out');

function encodeForm(fd){
  const sp = new URLSearchParams();
  for (const [k,v] of fd.entries()) sp.append(k, v);
  return sp;
}

// A. 原生 POST（無任何 JS 解析、無預檢；GAS 必收）
$('#btnNative').onclick = () => {
  const url = $('#api').value.trim();
  if(!url){ out.textContent = '請填入 /exec URL'; return; }
  const f = document.createElement('form');
  f.method = 'POST';
  f.action = url;
  f.target = '_blank';
  const fd = new FormData($('#F'));
  for (const [k,v] of fd.entries()){
    const inp = document.createElement('input');
    inp.type='hidden'; inp.name=k; inp.value=v;
    f.appendChild(inp);
  }
  document.body.appendChild(f);
  f.submit();            // 新分頁會顯示 GAS 回應 JSON
  f.remove();
  out.textContent = '已以原生表單送出（請看新分頁的回應）。';
};

// B. fetch 表單 POST（不設任何 headers → simple request）
$('#btnFetch').onclick = async () => {
  const url = $('#api').value.trim();
  if(!url){ out.textContent = '請填入 /exec URL'; return; }
  const body = encodeForm(new FormData($('#F'))); // application/x-www-form-urlencoded
  out.textContent = '送出中…';
  try{
    const res = await fetch(url, { method:'POST', body }); // 不設 headers → 不預檢
    const text = await res.text();
    let parsed;
    try{ parsed = JSON.parse(text); }catch(e){}
    out.textContent =
      '狀態: ' + res.status + '\n' +
      'content-type: ' + (res.headers.get('content-type')||'(無)') + '\n\n' +
      '── raw ──\n' + text + '\n\n' +
      (parsed ? '── json ──\n' + JSON.stringify(parsed,null,2) : '');
  }catch(e){
    out.textContent = '[Fetch 錯誤] ' + e;
  }
};
</script>
</html>