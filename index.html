<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RT外觀抽驗記錄表 | Index</title>
<style>
  :root{
    --wrap-w:95%; --max-w:900px;
    --ok:#10b981; --err:#ef4444; --muted:#6b7280; --bg:#f8fafc; --brand:#0f766e;
    --btn1:#ecfeff; --btn2:#f1f5f9; --btn3:#fff7ed; --btn4:#eff6ff;
  }
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:#0f172a}
  .wrap{width:var(--wrap-w);max-width:var(--max-w);margin:22px auto 32px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 6px 18px rgba(2,6,23,.06)}
  .hdr{padding:16px 18px 10px;border-bottom:1px solid #e5e7eb;text-align:center}
  .title{font-size:20px;font-weight:700;color:var(--brand)}
  .sub{color:#475569;font-size:12px;margin-top:4px}
  .content{padding:14px}
  .grid-wrap{width:75%; margin:0 auto;}
  .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
  .btn{
    display:flex; align-items:center; justify-content:center;
    padding:10px 12px;
    border-radius:12px; border:1px solid #e5e7eb;
    color:#0f172a; font-weight:600; text-decoration:none;
    font-family:"DFKai-SB","標楷體","PMingLiU",serif;
    font-size:16px; line-height:1.15;
  }
  .btn:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(2,6,23,.08);border-color:#d1d5db}
  .btn1{background:var(--btn1); border-color:#cffafe;}
  .btn2{background:var(--btn2); border-color:#e2e8f0;}
  .btn3{background:var(--btn3); border-color:#fed7aa;}
  .btn4{background:var(--btn4); border-color:#bfdbfe;}
  .btn .txt{display:inline-block; text-align:center; letter-spacing:0.4px;}
  .status-row{margin-top:14px;display:flex;align-items:center;justify-content:center;gap:22px;flex-wrap:wrap}
  .item{display:flex;align-items:center;gap:8px;}
  .item.gas .label{font-family:"Comic Sans MS","Comic Sans",cursive;}
  .dot{width:12px;height:12px;border-radius:50%;background:#d1d5d9;border:1px solid #cbd5e1;transition:background .15s,border-color .15s}
  .ok{background:var(--ok)!important;border-color:var(--ok)!important}
  .err{background:var(--err)!important;border-color:var(--err)!important}
  .foot{padding:10px 14px;display:flex;align-items:center;justify-content:space-between;color:#475569;font-size:12px}
  @media (max-width:760px){.grid-wrap{width:100%}.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap card">
    <div class="hdr">
      <div class="title">RT外觀抽驗記錄表</div>
      <div class="sub">入口導航</div>
    </div>
    <div class="content">
      <div class="grid-wrap">
        <div class="grid">
          <a class="btn btn1" href="browse.html"><span class="txt">　每日記錄表　</span></a>
          <a class="btn btn2" href="form.html"><span class="txt">　外觀記錄表　</span></a>
          <a class="btn btn3" href="formPro.html"><span class="txt">　外觀記錄表　</span></a>
          <a class="btn btn4" href="admin.html"><span class="txt">　安全管理員　</span></a>
        </div>
      </div>

      <div class="status-row">
        <div class="item gas"><span id="dot-alive" class="dot"></span><span class="label">GAS</span></div>
        <div class="item"><span id="dot-file"  class="dot"></span><span class="label">檔案</span></div>
        <div class="item"><span id="dot-sheet" class="dot"></span><span class="label">表名</span></div>
      </div>
    </div>
    <div class="foot">
      <div>版本 <span id="ver"></span></div>
      <div id="now"></div>
    </div>
  </div>

<script>
const CFG = {
  version: "v0.4.1-index-ui",
  apiBase: "https://script.google.com/macros/s/AKfycbz02U3mY1UTzWFJP6h0EkdTn3DZYAZRg5YnDWvFTncWV9CFibK6XDVj6gIxNx7ehNei/exec",
  targetParam: "check",
  firstDelayMs: 7000,
  nextDelayMs: 53000
};
document.getElementById('ver').textContent = CFG.version;

// 台北時間
function tick(){
  try{
    const tz = "Asia/Taipei";
    const now = new Date();
    const opt = { timeZone: tz, year:'numeric', month:'2-digit', day:'2-digit',
                  hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false };
    document.getElementById('now').textContent =
      new Intl.DateTimeFormat('zh-TW', opt).format(now);
  }catch(e){}
}
tick(); setInterval(tick, 1000);

const elAlive = document.getElementById('dot-alive');
const elFile  = document.getElementById('dot-file');
const elSheet = document.getElementById('dot-sheet');

function setDot(el, state){
  el.classList.remove('ok','err');
  if (state === 'ok') el.classList.add('ok');
  else if (state === 'err') el.classList.add('err');
}
const sleep = ms => new Promise(r=>setTimeout(r, ms));

async function getStatus(){
  try{
    const url = CFG.apiBase + "?target=" + encodeURIComponent(CFG.targetParam) + "&_=" + Date.now();
    const res = await fetch(url, {method:"GET", cache:"no-store"});
    const aliveState = res.ok ? 'ok' : 'err';

    let data = null;
    try{ data = await res.json(); }catch(_){ data = null; }

    setDot(elAlive, aliveState);
    if (data && data.fileExists === true) setDot(elFile, 'ok');
    if (data && data.sheetExists === true) setDot(elSheet, 'ok');

  }catch(e){
    setDot(elAlive, 'err');
  }
}

async function startLoop(){
  while(true){
    await sleep(CFG.firstDelayMs);
    await getStatus();
    await sleep(CFG.nextDelayMs);
  }
}
startLoop();
</script>
</body>
</html>