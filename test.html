<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<title>GAS 測試送出</title>
<style>
body { font-family:sans-serif; max-width:480px; margin:20px auto; }
label { display:block; margin:8px 0 4px; }
input { width:100%; padding:6px; }
button { margin-top:10px; padding:8px 16px; }
pre { background:#f5f5f5; padding:10px; white-space:pre-wrap; }
</style>
</head>
<body>
<h2>GAS 測試送出</h2>

<label>料號</label>
<input id="part" value="A12B345">
<label>批號</label>
<input id="lot" value="123-01">
<label>數量</label>
<input id="qty" type="number" value="10">
<label>檢驗員</label>
<input id="inspector" value="T1234">

<button onclick="submitTest()">送出測試</button>

<pre id="output"></pre>

<script>
const API_BASE = "你的部署網址";

function makeKey(mmdd, shift, part, lot) {
  return mmdd + "|" + shift + "|" + part + "|" + lot;
}

async function submitTest() {
  const part = document.getElementById('part').value.trim();
  const lot  = document.getElementById('lot').value.trim();
  const qty  = document.getElementById('qty').value.trim();
  const ins  = document.getElementById('inspector').value.trim();

  // 模擬台北時間 mmdd & shift
  const d = new Date();
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  const hhmm = d.getHours()*60 + d.getMinutes();
  const shift = hhmm>=40&&hhmm<520 ? "C" : (hhmm<1000 ? "A" : "B");
  const mmdd = mm + "/" + dd;

  const payload = {
    action:"submit",
    date: d.getFullYear()+"/"+mm+"/"+dd,
    shift: shift,
    part_no: part,
    lot: lot,
    qty: qty,
    inspector: ins,
    key: makeKey(mmdd, shift, part, lot),
    key2: `${mmdd}|${shift}|${part}|${lot}|TRUE`
  };

  try {
    const url = API_BASE + "?" + new URLSearchParams(payload).toString();
    const res = await fetch(url, {cache:"no-store"});
    const data = await res.json();
    document.getElementById('output').textContent =
      "回傳: " + JSON.stringify(data,null,2) + 
      "\n判斷: " + (data.mode==="更新" ? "更新成功" : "新增成功");
  } catch (e) {
    document.getElementById('output').textContent = "錯誤: " + e;
  }
}
</script>
</body>
</html>