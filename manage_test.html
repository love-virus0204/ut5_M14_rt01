<!doctype html><html lang="zh-Hant"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>QR 驗證測試</title>

<!-- 必須先載入 html5-qrcode CDN -->
<script src="https://unpkg.com/html5-qrcode@2.3.10/html5-qrcode.min.js"></script>

<style>
body{font-family:sans-serif;margin:0;background:#f7f7f7}
main{max-width:680px;margin:20px auto;padding:0 16px;text-align:center}
.btn{padding:10px 14px;border-radius:8px;background:#1677ff;color:#fff;border:0;margin:5px}
#reader{width:100%;max-width:360px;margin:12px auto}
#log{color:#c62828;white-space:pre-wrap;margin-top:8px}
.ok{color:#0a7b33;font-weight:700}
</style>
</head><body>
<main>
<h2>QR 驗證測試</h2>
<button id="startBtn" class="btn">開始掃描</button>
<button id="stopBtn" class="btn" disabled>停止掃描</button>
<div id="reader"></div>
<div id="log"></div>
<div id="ok" style="display:none" class="ok">✅ 驗證通過</div>
</main>

<script>
const TOKEN="f58f84dfd91a46d68f130d4a2ca2a783eaf649fe96284ef09395571e030106aab70b6258691887e3d22ce185105a943ff88b8c7f536aae149ea23d2bd83ffe3f";
const log = m=>document.getElementById('log').textContent=m;
let qr=null, running=false;

async function startScan(){
  if(running) return;
  try{
    qr = new Html5Qrcode("reader",{verbose:true});
    await qr.start(
      { facingMode:"environment" },
      { fps:10, qrbox:{width:260,height:260} },
      txt=>{
        if((txt||"").trim()===TOKEN){
          stopScan();document.getElementById('ok').style.display='block';
        }else log("掃到內容但不匹配。");
      });
    running=true;
    document.getElementById('startBtn').disabled=true;
    document.getElementById('stopBtn').disabled=false;
    log("相機啟動成功");
  }catch(e){ log("啟動相機失敗：\n"+e); }
}
async function stopScan(){
  if(qr&&running){ try{await qr.stop();await qr.clear();}catch(_){}
    running=false;document.getElementById('startBtn').disabled=false;
    document.getElementById('stopBtn').disabled=true;
  }
}
document.getElementById('startBtn').addEventListener('click',startScan);
document.getElementById('stopBtn').addEventListener('click',stopScan);
</script>
</body></html>