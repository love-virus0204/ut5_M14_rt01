<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>外觀記錄表</title>
<!-- 保留原有 meta、css、版面設定完全不變 -->
...
<script>
const FORM_VERSION="v17.10.12";
// === 時區處理：台北本機直用；非台北以伺服器時間校正一次，保存 delta ===
function __isTaipeiTZ(){
  try{ return Intl.DateTimeFormat().resolvedOptions().timeZone === "Asia/Taipei"; }catch(_){ return false; }
}
function __loadDelta(){
  try{ return Number(localStorage.getItem("rt_tz_delta_ms")||"0"); }catch(_){ return 0; }
}
function __saveDelta(ms){
  try{ localStorage.setItem("rt_tz_delta_ms", String(ms)); localStorage.setItem("rt_tz_saved_at", String(Date.now())); }catch(_){}
}
function __nowTaipei(){
  var delta = __loadDelta();
  return new Date(Date.now() + (isFinite(delta)?delta:0));
}
async function __initTaipeiTimeOnce(){
  try{
    if(__isTaipeiTZ()){
      var d = new Date();
      var y = d.getFullYear(), m = String(d.getMonth()+1).padStart(2,"0"), dd = String(d.getDate()).padStart(2,"0");
      var date = y+"/"+m+"/"+dd;
      var dsText = (typeof computeShiftByClockFrom==="function") ? computeShiftByClockFrom(y+"/"+m+"/"+dd+" "+String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0")+":00") : "";
      window._dsDate = date;
      if(dsText) window._dsShift = dsText;
    }else{
      var u = new URL(API_BASE); u.searchParams.set("action","ping");
      var r = await fetch(u.toString(), {method:"GET", cache:"no-store"});
      var j = await r.json();
      if(j && j.server_time){
        var s = String(j.server_time);
        var parts = s.split(" ");
        var dt = parts[0] + " " + (parts[1]||"00:00:00");
        var serverMs = Date.parse(dt.replace(/-/g,"/"));
        var delta = serverMs - Date.now();
        __saveDelta(delta);
        var d2 = __nowTaipei();
        var y2 = d2.getFullYear(), m2 = String(d2.getMonth()+1).padStart(2,"0"), dd2 = String(d2.getDate()).padStart(2,"0");
        var date2 = y2+"/"+m2+"/"+dd2;
        var sh2 = (typeof computeShiftByClockFrom==="function") ? computeShiftByClockFrom(date2+" "+String(d2.getHours()).padStart(2,"0")+":"+String(d2.getMinutes()).padStart(2,"0")+":00") : "";
        window._dsDate = date2;
        if(sh2) window._dsShift = sh2;
      }
    }
    try{
      var dShow = (window._dsDate&&window._dsDate.length>=10) ? (window._dsDate.slice(5,7)+"/"+window._dsDate.slice(8,10)) : "";
      var dsEl = document.getElementById("ds");
      if(dsEl && dShow){
        var curShift = (window._dsShift||"").toString().trim();
        dsEl.textContent = curShift ? (dShow+" - "+curShift) : (dShow+" - ");
      }
    }catch(__e){}
  }catch(e){}
}
document.addEventListener("DOMContentLoaded", function(){ try{__initTaipeiTimeOnce();}catch(_){}});

// 保留原有初始化、事件監聽、草稿機制等全部不變
</script>
...
<script>
// 原送出函式，僅調整 payload.date/shift
function submitGET(){
  const payload = {
    date:(window._dsDate||date),
    shift:(window._dsShift||shift),
    part_no:document.getElementById("part_no").value,
    lot:document.getElementById("lot").value,
    qty:document.getElementById("qty").value,
    inspector:document.getElementById("inspector").value,
    key:window.currentKey,
    key2:window.currentKey2
  };
  // 保留原 fetch(GET) 請求與草稿寫入邏輯
}
</script>
...
<footer>
<div class="version">v17.10.12</div>
</footer>
</body>
</html>