<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>即時備份</title>
<style>
  body {
    margin:0;
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#f8fafc;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    color:#334155;
  }
  .card {
    background:#fff;
    padding:2rem;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
    text-align:center;
    width:90%;
    max-width:320px;
  }
  .spinner {
    width:48px; height:48px;
    margin:1rem auto;
    border:6px solid #e2e8f0;
    border-top-color:#3b82f6;
    border-radius:50%;
    animation:spin 1s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .btn {
    display:inline-block;
    margin-top:1rem;
    padding:0.5rem 1rem;
    border:none;
    border-radius:6px;
    background:#3b82f6;
    color:#fff;
    font-size:1rem;
    cursor:pointer;
  }
</style>
</head>
<body>
  <div class="card">
    <div id="statusTitle">正在準備備份</div>
    <div class="spinner" id="spinner"></div>
    <div id="statusMsg">請稍候…</div>
    <button id="btnBack" class="btn" style="display:none;">返回首頁</button>
  </div>

<script>
const CFG = { apiBase: "YOUR_GAS_DEPLOY_URL" }; // ← 替換成你的 GAS 部署網址

const titleEl = document.getElementById('statusTitle');
const msgEl   = document.getElementById('statusMsg');
const spinner = document.getElementById('spinner');
const btnBack = document.getElementById('btnBack');

function goHome(){
  window.location.href = "index.html"; // 主頁
}

btnBack.addEventListener('click', goHome);

// 延遲 0.5 秒再觸發
setTimeout(async ()=>{
  titleEl.textContent = "執行即時備份";
  msgEl.textContent   = "備份進行中…";

  try {
    const res = await fetch(CFG.apiBase, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ action:"backup" })
    });
    const data = await res.json().catch(()=>({}));
    if(res.ok && data.status === "ok"){
      spinner.style.display="none";
      titleEl.textContent = "備份成功";
      msgEl.textContent   = "2 秒後返回首頁…";
      setTimeout(goHome,2000);
    }else{
      throw new Error(data.msg || "HTTP "+res.status);
    }
  }catch(err){
    spinner.style.display="none";
    titleEl.textContent = "備份失敗";
    msgEl.textContent   = "原因："+(err.message||err)+"。請稍後再試。";
    btnBack.style.display="inline-block";
  }
},500);
</script>
</body>
</html>